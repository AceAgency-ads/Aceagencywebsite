---
phase: 01-foundation-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/i18n/routing.ts
  - src/i18n/request.ts
  - src/middleware.ts
  - src/app/[locale]/layout.tsx
  - src/app/[locale]/page.tsx
  - src/app/layout.tsx
  - src/messages/ro.json
  - src/messages/en.json
  - src/components/layout/LanguageSwitcher.tsx
  - next.config.ts
autonomous: true

must_haves:
  truths:
    - "Visiting / redirects to /ro (default locale)"
    - "Visiting /ro shows Romanian content visible in View Source HTML (server-rendered)"
    - "Visiting /en shows English content visible in View Source HTML (server-rendered)"
    - "Language switcher at /ro switches to /en preserving the current path"
    - "Language switcher at /en switches to /ro preserving the current path"
    - "HTML head contains hreflang tags for ro, en, and x-default"
    - "HTML lang attribute is 'ro' on Romanian pages and 'en' on English pages"
  artifacts:
    - path: "src/i18n/routing.ts"
      provides: "Locale routing configuration (ro, en, defaultLocale ro)"
      contains: "defineRouting"
    - path: "src/i18n/request.ts"
      provides: "Server-side request config loading translation messages"
      contains: "getRequestConfig"
    - path: "src/middleware.ts"
      provides: "next-intl middleware for locale detection and URL rewriting"
      contains: "createMiddleware"
    - path: "src/app/[locale]/layout.tsx"
      provides: "Locale-specific layout with NextIntlClientProvider and dynamic lang attribute"
      contains: "NextIntlClientProvider"
    - path: "src/app/[locale]/page.tsx"
      provides: "Homepage using server-side translations"
      contains: "getTranslations"
    - path: "src/messages/ro.json"
      provides: "Romanian translation strings with namespaces"
    - path: "src/messages/en.json"
      provides: "English translation strings with namespaces"
    - path: "src/components/layout/LanguageSwitcher.tsx"
      provides: "Client component for switching between ro and en"
      contains: "use client"
  key_links:
    - from: "src/middleware.ts"
      to: "src/i18n/routing.ts"
      via: "import routing config"
      pattern: "import.*routing"
    - from: "src/app/[locale]/layout.tsx"
      to: "src/i18n/request.ts"
      via: "next-intl server integration"
      pattern: "NextIntlClientProvider"
    - from: "src/app/[locale]/page.tsx"
      to: "src/messages/*.json"
      via: "getTranslations loading namespaced keys"
      pattern: "getTranslations"
    - from: "next.config.ts"
      to: "src/i18n/request.ts"
      via: "withNextIntl plugin wrapping config"
      pattern: "createNextIntlPlugin"
    - from: "src/components/layout/LanguageSwitcher.tsx"
      to: "src/i18n/routing.ts"
      via: "locale list for switcher options"
      pattern: "useLocale|usePathname"
---

<objective>
Set up bilingual routing with next-intl so every page automatically gets locale-based URLs (/ro/* and /en/*), server-rendered translations, a language switcher, and proper hreflang tags.

Purpose: i18n is the foundational routing structure -- every page in every subsequent phase lives under [locale]. Getting this right now means all future pages automatically inherit bilingual support without additional wiring.

Output: Working /ro and /en routes with server-rendered translations, a functional language switcher component, hreflang tags in HTML head, and complete Romanian/English translation files for Phase 1 UI strings.
</objective>

<execution_context>
@C:/Users/PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md
@.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure next-intl routing, middleware, and locale layout</name>
  <files>
    src/i18n/routing.ts
    src/i18n/request.ts
    src/middleware.ts
    src/app/[locale]/layout.tsx
    src/app/layout.tsx
    next.config.ts
    package.json
  </files>
  <action>
    1. **Install next-intl:**
    ```bash
    npm install next-intl
    ```

    2. **Create `src/i18n/routing.ts`** -- defines available locales and default:
    ```ts
    import { defineRouting } from 'next-intl/routing'
    import { createNavigation } from 'next-intl/navigation'

    export const routing = defineRouting({
      locales: ['ro', 'en'],
      defaultLocale: 'ro',
      localePrefix: 'always' // Force /ro and /en in all URLs
    })

    // Typed navigation helpers for use in components
    export const { Link, redirect, usePathname, useRouter } = createNavigation(routing)
    ```

    3. **Create `src/i18n/request.ts`** -- server-side config that loads messages:
    ```ts
    import { getRequestConfig } from 'next-intl/server'
    import { routing } from './routing'

    export default getRequestConfig(async ({ requestLocale }) => {
      let locale = await requestLocale

      if (!locale || !routing.locales.includes(locale as 'ro' | 'en')) {
        locale = routing.defaultLocale
      }

      return {
        locale,
        messages: (await import(`../messages/${locale}.json`)).default
      }
    })
    ```

    4. **Create `src/middleware.ts`** -- locale detection and URL rewriting:
    ```ts
    import createMiddleware from 'next-intl/middleware'
    import { routing } from './i18n/routing'

    export default createMiddleware(routing)

    export const config = {
      matcher: ['/((?!api|_next|_vercel|.*\\..*).*)']
    }
    ```

    5. **Update `next.config.ts`** -- wrap existing config with next-intl plugin:
    ```ts
    import type { NextConfig } from 'next'
    import createNextIntlPlugin from 'next-intl/plugin'

    const withNextIntl = createNextIntlPlugin('./src/i18n/request.ts')

    const nextConfig: NextConfig = {
      images: {
        remotePatterns: [
          {
            protocol: 'https',
            hostname: 'images.unsplash.com',
            pathname: '/**',
          },
        ],
        formats: ['image/avif', 'image/webp'],
      },
    }

    export default withNextIntl(nextConfig)
    ```

    6. **Restructure layouts** -- Move page content under `[locale]` segment:

    a. **Update `src/app/layout.tsx`** (root layout) -- Keep fonts, remove page-specific content. The root layout should NOT set `lang` attribute (that's done in locale layout):
    ```tsx
    import type { Metadata } from 'next'
    // ... font imports from Plan 01 ...
    import './globals.css'

    export const metadata: Metadata = {
      title: 'AceAgency',
      description: 'Full-service digital marketing agency in Bucharest, Romania',
    }

    export default function RootLayout({
      children,
    }: {
      children: React.ReactNode
    }) {
      return (
        <html className={`${glacialIndifference.variable} ${poppins.variable} ${redHatDisplay.variable} ${anton.variable}`}>
          <body className="antialiased">{children}</body>
        </html>
      )
    }
    ```

    NOTE: Remove `lang="ro"` from the html tag -- the locale layout will handle this. The html tag in root layout should NOT have a lang attribute since it wraps both locales.

    b. **Create `src/app/[locale]/layout.tsx`** (locale layout) -- wraps all locale pages:
    ```tsx
    import { NextIntlClientProvider, hasLocale } from 'next-intl'
    import { getMessages, setRequestLocale } from 'next-intl/server'
    import { notFound } from 'next/navigation'
    import { routing } from '@/i18n/routing'

    export function generateStaticParams() {
      return routing.locales.map((locale) => ({ locale }))
    }

    export default async function LocaleLayout({
      children,
      params,
    }: {
      children: React.ReactNode
      params: Promise<{ locale: string }>
    }) {
      const { locale } = await params

      if (!hasLocale(routing.locales, locale)) {
        notFound()
      }

      setRequestLocale(locale)
      const messages = await getMessages()

      return (
        <NextIntlClientProvider locale={locale} messages={messages}>
          {children}
        </NextIntlClientProvider>
      )
    }
    ```

    NOTE: In Next.js 16 with App Router, `params` is a Promise that must be awaited. The locale layout does NOT render `<html>` or `<body>` -- only the root layout does that. The locale is passed to NextIntlClientProvider for client components.

    IMPORTANT: The `lang` attribute needs to be set on the `<html>` element. Since only the root layout renders `<html>`, you need to find a way to pass the locale to it. Options:
    - Use next-intl's built-in approach: the middleware sets locale headers that next-intl reads
    - Set `lang` via a script or metadata approach
    - The simplest approach: In the root layout, read the locale from the request using next-intl's `getLocale()` and set it on `<html lang={locale}>`. Import `getLocale` from `next-intl/server`.

    7. **Delete the old `src/app/page.tsx`** (if it still exists at root level). The homepage is now at `src/app/[locale]/page.tsx`.
  </action>
  <verify>
    1. Run `npm run dev` -- server starts without errors.
    2. Visit `http://localhost:3000/` -- should redirect to `http://localhost:3000/ro`.
    3. Visit `http://localhost:3000/ro` -- should render the page (even if content is minimal at this point).
    4. Visit `http://localhost:3000/en` -- should render the page.
    5. Run `npm run build` -- production build succeeds, generates static pages for both locales.
  </verify>
  <done>
    next-intl routing is active. Visiting / redirects to /ro. Both /ro and /en serve pages. The locale layout wraps pages with NextIntlClientProvider. Production build generates pages for both locales.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create translation files, homepage with SSR translations, language switcher, and hreflang tags</name>
  <files>
    src/messages/ro.json
    src/messages/en.json
    src/app/[locale]/page.tsx
    src/components/layout/LanguageSwitcher.tsx
    src/app/[locale]/layout.tsx
  </files>
  <action>
    1. **Create `src/messages/ro.json`** -- Romanian translations with namespaces. Include all UI strings needed for Phase 1 and placeholders for Navigation namespace (used by Header/Footer in Phase 2):
    ```json
    {
      "Metadata": {
        "title": "AceAgency | Agentie de Marketing Digital Bucuresti",
        "description": "Agentie full-service de marketing digital in Bucuresti. Google Ads, Meta Ads, SEO, Automatizare AI, Dezvoltare Web, Productie Video. 200+ proiecte, 95% retentie clienti."
      },
      "HomePage": {
        "title": "Transformam afacerea ta prin marketing digital",
        "subtitle": "Agentie full-service de marketing digital in Bucuresti",
        "cta": "Solicita o consultatie gratuita",
        "stats": {
          "projects": "200+ proiecte",
          "businesses": "50+ afaceri",
          "sales": "4M+ EUR vanzari",
          "retention": "95% retentie",
          "roi": "350% ROI",
          "experience": "6+ ani"
        }
      },
      "Navigation": {
        "home": "Acasa",
        "about": "Despre noi",
        "services": "Servicii",
        "portfolio": "Portofoliu",
        "blog": "Blog",
        "contact": "Contact",
        "faq": "Intrebari frecvente"
      },
      "LanguageSwitcher": {
        "switchTo": "Switch to English",
        "currentLanguage": "Romana"
      },
      "Common": {
        "learnMore": "Afla mai mult",
        "contactUs": "Contacteaza-ne",
        "readMore": "Citeste mai mult",
        "backToHome": "Inapoi acasa"
      }
    }
    ```

    2. **Create `src/messages/en.json`** -- English translations with identical namespace structure:
    ```json
    {
      "Metadata": {
        "title": "AceAgency | Digital Marketing Agency Bucharest",
        "description": "Full-service digital marketing agency in Bucharest, Romania. Google Ads, Meta Ads, SEO, AI Automation, Web Development, Video Production. 200+ projects, 95% client retention."
      },
      "HomePage": {
        "title": "Transform your business through digital marketing",
        "subtitle": "Full-service digital marketing agency in Bucharest",
        "cta": "Request a free consultation",
        "stats": {
          "projects": "200+ projects",
          "businesses": "50+ businesses",
          "sales": "4M+ EUR sales",
          "retention": "95% retention",
          "roi": "350% ROI",
          "experience": "6+ years"
        }
      },
      "Navigation": {
        "home": "Home",
        "about": "About",
        "services": "Services",
        "portfolio": "Portfolio",
        "blog": "Blog",
        "contact": "Contact",
        "faq": "FAQ"
      },
      "LanguageSwitcher": {
        "switchTo": "Schimba in Romana",
        "currentLanguage": "English"
      },
      "Common": {
        "learnMore": "Learn more",
        "contactUs": "Contact us",
        "readMore": "Read more",
        "backToHome": "Back to home"
      }
    }
    ```

    3. **Create `src/app/[locale]/page.tsx`** -- Homepage using server-side translations (NOT "use client"). This replaces the design system test page from Plan 01. Show the brand colors and typography PLUS translated content to verify both design system and i18n work together:
    ```tsx
    import { getTranslations, setRequestLocale } from 'next-intl/server'
    import { LanguageSwitcher } from '@/components/layout/LanguageSwitcher'

    export default async function HomePage({ params }: { params: Promise<{ locale: string }> }) {
      const { locale } = await params
      setRequestLocale(locale)
      const t = await getTranslations('HomePage')

      return (
        <main className="min-h-screen p-8 space-y-12">
          {/* Language Switcher */}
          <div className="flex justify-end">
            <LanguageSwitcher />
          </div>

          {/* Hero section with translated content */}
          <section className="text-center space-y-4">
            <h1 className="font-headline text-4xl md:text-6xl font-bold text-brand-black">
              {t('title')}
            </h1>
            <p className="font-subheading text-xl text-brand-black/70">
              {t('subtitle')}
            </p>
            <button className="bg-electric-violet text-white px-8 py-3 rounded-lg font-body text-lg hover:bg-cobalt-blue transition-colors">
              {t('cta')}
            </button>
          </section>

          {/* Stats grid */}
          <section className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 max-w-5xl mx-auto">
            {(['projects', 'businesses', 'sales', 'retention', 'roi', 'experience'] as const).map((key) => (
              <div key={key} className="text-center p-4 bg-brand-grey/30 rounded-lg">
                <p className="font-secondary text-lg text-electric-violet">{t(`stats.${key}`)}</p>
              </div>
            ))}
          </section>

          {/* Brand colors verification */}
          <section className="space-y-4">
            <h2 className="font-subheading text-2xl">Brand Colors</h2>
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
              <div className="bg-electric-violet text-white p-4 rounded-lg text-center text-sm">Electric Violet</div>
              <div className="bg-burgundy text-white p-4 rounded-lg text-center text-sm">Burgundy</div>
              <div className="bg-electric-mint text-brand-black p-4 rounded-lg text-center text-sm">Electric Mint</div>
              <div className="bg-cobalt-blue text-white p-4 rounded-lg text-center text-sm">Cobalt Blue</div>
              <div className="bg-brand-black text-white p-4 rounded-lg text-center text-sm">Brand Black</div>
              <div className="bg-brand-grey text-brand-black p-4 rounded-lg text-center text-sm">Brand Grey</div>
            </div>
          </section>

          {/* Typography verification */}
          <section className="space-y-2">
            <h2 className="font-subheading text-2xl">Typography</h2>
            <p className="font-headline text-xl">Glacial Indifference (Headlines)</p>
            <p className="font-subheading text-xl">Red Hat Display (Subheadings)</p>
            <p className="font-body text-xl">Poppins (Body Text)</p>
            <p className="font-secondary text-xl">Anton (Secondary Headlines)</p>
          </section>
        </main>
      )
    }
    ```

    4. **Create `src/components/layout/LanguageSwitcher.tsx`** -- Client component for switching locales:
    ```tsx
    'use client'

    import { useLocale, useTranslations } from 'next-intl'
    import { usePathname, useRouter } from '@/i18n/routing'
    import { routing } from '@/i18n/routing'

    export function LanguageSwitcher() {
      const locale = useLocale()
      const pathname = usePathname()
      const router = useRouter()
      const t = useTranslations('LanguageSwitcher')

      const switchLocale = (newLocale: string) => {
        router.replace(pathname, { locale: newLocale })
      }

      return (
        <div className="flex items-center gap-2" role="navigation" aria-label="Language switcher">
          {routing.locales.map((loc) => (
            <button
              key={loc}
              onClick={() => switchLocale(loc)}
              disabled={locale === loc}
              className={`px-3 py-1 rounded text-sm font-body transition-colors ${
                locale === loc
                  ? 'bg-electric-violet text-white cursor-default'
                  : 'bg-brand-grey/30 text-brand-black hover:bg-electric-violet/10'
              }`}
              aria-current={locale === loc ? 'true' : undefined}
              aria-label={loc === locale ? t('currentLanguage') : t('switchTo')}
            >
              {loc.toUpperCase()}
            </button>
          ))}
        </div>
      )
    }
    ```

    NOTE: Use `usePathname` and `useRouter` from `@/i18n/routing` (the navigation helpers created by `createNavigation`), NOT from `next/navigation`. This ensures locale-aware path handling. The `router.replace(pathname, { locale: newLocale })` approach from next-intl correctly switches locale while preserving the path.

    5. **Update `src/app/[locale]/layout.tsx`** -- Add generateMetadata for hreflang tags:
    ```tsx
    import { getTranslations } from 'next-intl/server'

    export async function generateMetadata({ params }: { params: Promise<{ locale: string }> }) {
      const { locale } = await params
      const t = await getTranslations({ locale, namespace: 'Metadata' })

      return {
        title: t('title'),
        description: t('description'),
        alternates: {
          canonical: `https://aceads.co/${locale}`,
          languages: {
            'ro': 'https://aceads.co/ro',
            'en': 'https://aceads.co/en',
            'x-default': 'https://aceads.co/ro',
          },
        },
      }
    }
    ```

    Add this `generateMetadata` export to the existing locale layout file (alongside the existing layout component and generateStaticParams).
  </action>
  <verify>
    1. Run `npm run dev`.
    2. Visit `http://localhost:3000/ro` -- should show Romanian content: "Transformam afacerea ta prin marketing digital". View Source (Ctrl+U) should contain the Romanian text in the HTML (server-rendered, NOT client-rendered).
    3. Visit `http://localhost:3000/en` -- should show English content: "Transform your business through digital marketing". View Source should contain English text in HTML.
    4. Click the "EN" button on the Romanian page -- should navigate to /en while showing the same page content in English.
    5. Click the "RO" button on the English page -- should navigate to /ro while showing Romanian content.
    6. View Source on any page -- look for `<link rel="alternate" hreflang="ro" href="https://aceads.co/ro">` and similar tags for en and x-default in the head.
    7. Check HTML `<html>` tag has correct `lang` attribute for each locale.
    8. Run `npm run build` -- should generate static pages for both /ro and /en.
  </verify>
  <done>
    /ro serves server-rendered Romanian content visible in View Source. /en serves server-rendered English content visible in View Source. Language switcher toggles between locales preserving the current path. Hreflang tags for ro, en, and x-default appear in HTML head. HTML lang attribute matches the current locale. Translation files contain all Phase 1 UI strings with proper namespacing.
  </done>
</task>

</tasks>

<verification>
1. `http://localhost:3000/` redirects to `http://localhost:3000/ro`
2. `/ro` renders Romanian translations visible in View Source HTML (not client-side rendered)
3. `/en` renders English translations visible in View Source HTML
4. Language switcher on `/ro` navigates to `/en` preserving the path
5. Language switcher on `/en` navigates to `/ro` preserving the path
6. View Source contains hreflang link tags for ro, en, and x-default
7. HTML lang attribute is "ro" on Romanian pages and "en" on English pages
8. `npm run build` generates static pages for both locales
9. Brand colors and fonts still render correctly (no regression from Plan 01)
</verification>

<success_criteria>
- next-intl routing active with /ro and /en URL segments
- Middleware redirects / to /ro (default locale)
- Server-side translations visible in View Source HTML for both locales
- Language switcher toggles between RO/EN preserving current page path
- Hreflang tags in HTML head for ro, en, and x-default
- HTML lang attribute set dynamically per locale
- Translation files (ro.json, en.json) contain namespaced keys for HomePage, Navigation, LanguageSwitcher, Common, Metadata
- Production build generates static pages for both locales
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-02-SUMMARY.md`
</output>
